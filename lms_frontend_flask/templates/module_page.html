<!-- lms_frontend_flask/templates/module_page.html -->
{% extends "base.html" %}

{% block title %}{{ module.title }} - {{ course.title }}{% endblock %}

{% block navigation %}
    <p><a href="{{ url_for('home') }}">&laquo; All Courses</a></p>
    <hr>
    <h4>Course: {{ course.title }}</h4>
    {# The main navigation_items from base.html context processor will be used here #}
    {# We are overriding this block to provide more specific context #}
    <p><strong>Modules in this course:</strong></p>
    <ul>
    {% for nav_course_item in navigation_items %} {# Use the globally injected navigation_items #}
        {% if nav_course_item.course_ext_id == course.course_ext_id %} {# Compare with current course's ext_id #}
            {% for nav_module_item in nav_course_item.modules %}
            <li>
                <a href="{{ url_for('show_module_activities', course_ext_id=nav_course_item.course_ext_id, module_ext_id=nav_module_item.module_ext_id) }}" {% if nav_module_item.module_ext_id == module.module_ext_id %}style="font-weight: bold;"{% endif %}>
                    {{ nav_module_item.title }}
                </a>
            </li>
            {% endfor %}
        {% endif %}
    {% endfor %}
    </ul>
{% endblock %}

{% block content %}
    <h2>Module: {{ module.title }}</h2>
    <p><em>{{ module.description }}</em></p>

    <h3>Activities in this module:</h3>
    {% if activities %}
    <ul>
        {% for activity_item in activities %}
        <li>
            {# Use activity_ext_id for the link #}
            <a href="{{ url_for('show_activity', course_ext_id=course.course_ext_id, module_ext_id=module.module_ext_id, activity_ext_id=activity_item.activity_ext_id) }}">
                {{ activity_item.title }}
            </a>
            <p><small>{{ activity_item.description }}</small></p>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p>No activities in this module yet.</p>
    {% endif %}
{% endblock %}

{% block ai_chat %}
    <div id="chat-history" style="height: 300px; border: 1px solid #eee; overflow-y: scroll; padding: 10px; margin-bottom:10px;">
        <p><em>Select an activity to interact with the AI Assistant.</em></p>
    </div>
    <div id="chat-input-area">
        <input type="text" id="student-input" style="width: calc(100% - 60px); padding: 8px;" placeholder="Type your message..." disabled>
        <button id="send-button" style="padding: 8px;" disabled>Send</button>
    </div>
{% endblock %}
