# AITA Dialogue Authoring Tool: User Guide (V1)

## 1. Introduction

### Purpose of the Authoring Tool
Welcome to the AITA Dialogue Authoring Tool! This tool is designed to empower educators, curriculum specialists, subject matter experts (SMEs), and AI trainers to easily create and edit high-quality training dialogues for AI Tutors (AITAs). It ensures that the dialogues conform to the project's enhanced AITA JSON format, which is crucial for consistency and for fine-tuning effective AITA models.

### Key Capabilities
*   **Create**: Start new dialogues from a blank, structured template.
*   **Load**: Import existing AITA JSON files for review or modification.
*   **Edit**: Modify all aspects of a dialogue, from global metadata and context to individual turns and pedagogical annotations.
*   **Save**: Export dialogues in the standard AITA JSON format, ready for use in training datasets.

## 2. Setup & Running the Tool

### Prerequisites
*   **Python**: Version 3.9 or higher is recommended.
*   **Streamlit**: The tool is built using Streamlit.
*   **Standard Libraries**: The tool uses standard Python libraries like `json` and `datetime`.

To install Streamlit (if you haven't already):
```bash
pip install streamlit
```

### Running the Tool
1.  Ensure you have the `aita_dialogue_authoring_tool.py` script.
2.  Open your terminal or command prompt.
3.  Navigate to the directory where the script is located.
4.  Run the following command:
    ```bash
    streamlit run aita_dialogue_authoring_tool.py
    ```
5.  Streamlit will typically open the application automatically in your default web browser. If not, it will display a local URL (usually `http://localhost:8501`) which you can open in your browser.

## 3. Overview of the User Interface

The Authoring Tool is organized for ease of use:

*   **Sidebar (Left Panel)**: Contains global **File Operations**:
    *   Load an existing AITA Dialogue JSON file.
    *   Save the current dialogue to a JSON file.
    *   Create a new, blank dialogue.
*   **Main Area (Center Panel)**: Uses tabs to organize the different sections of the dialogue you are editing:
    *   **Global Dialogue Info**: For metadata, AITA profile, pedagogical intent, and the main contextual information (like passage text).
    *   **Dialogue Turns Editor**: For creating and editing the sequence of AITA and student turns.
    *   **Assessment & Session Metadata**: For conceptual final assessment notes and teacher oversight metadata.

## 4. Step-by-Step Instructions for Key Tasks

### 4.1. Creating a New Dialogue
1.  In the sidebar, click the **"Create New Dialogue"** button.
2.  The main editing area will reset, presenting a blank dialogue structure.
3.  A unique `dialogue_id` and current timestamps (`creation_timestamp_utc`, `last_updated_timestamp_utc`) are automatically generated for the new dialogue. The `version` field will also be pre-filled (e.g., "1.5\_AITA\_AuthoringTool\_V1").
4.  You can now proceed to fill in the global information and add dialogue turns.

### 4.2. Loading an Existing Dialogue
1.  In the sidebar, locate the **"Load AITA Dialogue JSON"** file uploader widget.
2.  Click "Browse files" and select an AITA JSON file from your computer.
3.  If the file is valid and successfully parsed, the tool's input fields will populate with the data from the loaded dialogue. A success message will appear.
4.  If there's an error (e.g., invalid JSON, missing key fields), an error message will be displayed.
5.  This feature can load files previously saved by this tool or compatible AITA JSON files generated by other scripts (like `data_processing_scripts.py`, assuming they represent a single dialogue object).

### 4.3. Saving a Dialogue
1.  Once you have finished creating or editing your dialogue, click the **"Save Dialogue as JSON"** button in the sidebar.
2.  Your browser will download a JSON file.
3.  The suggested filename is automatically generated based on the dialogue's `dialogue_id` (e.g., `dialogue_xyz123.json`). You can change the filename before saving if needed.

### 4.4. Editing Global Dialogue Information (in "Global Dialogue Info" Tab)

This tab contains several expandable sections for defining the overall context of the dialogue:

*   **Dialogue ID & Version**:
    *   `Dialogue ID`: While auto-generated for new dialogues, you can edit it. Ensure it remains unique.
    *   `Schema Version`: Displays the version of the AITA JSON schema this tool uses.
*   **Metadata Section**:
    *   `Source Content ID`: ID of the original passage or content item.
    *   `Source Dataset Name`: Name of the dataset the source content belongs to.
    *   `Tags`: Enter relevant keywords as a **comma-separated list** (e.g., `reading, 4th grade, main idea`).
*   **AITA Profile Section**:
    *   `Subject`: The subject the AITA is tutoring (e.g., "Reading Comprehension").
    *   `Grade Level`: Target grade (e.g., "4").
    *   `Persona Name`: A name for this AITA persona (e.g., "ReaderAITA\_Explorer\_v1.4\_Iter1").
    *   `Target Audience Description`: Brief description of the intended student.
*   **Pedagogical Intent Section**:
    *   `Interaction Type`: Describe the pedagogical approach (e.g., "guided_discovery_main_idea").
    *   `Learning Objectives`: **For V1, edit this as a JSON string in the text area.** It should be a list of objects, each with an "id" and "text" field. Example:
        ```json
        [
          {
            "id": "RC.4.LO1.MainIdea.Narrative",
            "text": "Identify the main idea of a short narrative passage..."
          }
        ]
        ```
    *   `Expected Student Thinking`: Describe the cognitive process you expect the student to go through.
    *   `Keywords`: Relevant pedagogical or domain keywords as a **comma-separated list**.
    *   `Difficulty Level`: e.g., "4th_grade_on_level".
*   **Context Provided to AITA Section**:
    *   `Content Item ID`: ID for the passage or content item being discussed.
    *   `Content Item Title`: Title of the passage.
    *   `Content Item Text (e.g., Full Passage)`: **This is a large text area where you should paste or type the full text of the reading passage or problem description.**
    *   Other fields like `user_id`, `session_id` are typically pre-filled with placeholders for authoring.

### 4.5. Working with the Dialogue Turns Editor (in "Dialogue Turns Editor" Tab)

This is where you build the conversation flow.

*   **Display**: Each turn is displayed in an expandable section (`st.expander`), showing a preview of the speaker and utterance.
*   **Adding Turns**:
    *   Click **"Add Student Turn"** to add a new turn for the student.
    *   Click **"Add AITA Turn"** to add a new turn for the AITA.
    *   New turns are added to the end of the dialogue.
*   **Editing a Turn**:
    *   Click on an expander to open the turn for editing.
    *   **Speaker**: Choose "AITA" or "student" from the dropdown.
    *   **Utterance**: Type or edit the text for that turn in the main text area.
    *   **AITA-Specific Fields** (these appear only if "AITA" is selected as the speaker):
        *   **`Pedagogical Notes`**: Enter notes in the text area. **Each distinct note should be on a new line.** The tool will save these as a list of strings in the JSON.
            *   *Example Input:*
                ```
                Acknowledge student's partial understanding.
                Prompt for the resolution part of the story.
                Use encouraging language.
                ```
            *   *Saved as:* `["Acknowledged student's partial understanding.", "Prompted for the resolution part of the story.", "Use encouraging language."]`
        *   **`Safeguard Tags`, `Ontology Concept Tags`**: Enter these as **comma-separated lists** in their respective text input fields (e.g., `safe, on-topic` or `main_idea_elicitation, scaffolding`).
        *   **`xAPI Verb ID`, `xAPI Object ID`**: Text inputs for these conceptual URI placeholders.
        *   **`AITA Confidence (0.0-1.0)`**: Numerical input for the AITA's confidence in its response.
*   **Deleting Turns**: Click the "Delete Turn" button within the expander for the turn you wish to remove.
*   **Reordering Turns (Future)**: V1 does not have drag-and-drop reordering. Turns are processed in the order they appear. You may need to delete and re-add turns to change their order significantly.

### 4.6. Editing Assessment & Session Metadata (in "Assessment & Session Metadata" Tab)

This tab allows you to conceptually fill in fields related to the end-of-dialogue assessment and teacher oversight.
*   **Final Assessment of Student Understanding**:
    *   `Summary of Understanding`: Text area for a qualitative summary.
    *   `Mastery Levels`: **For V1, edit this as a JSON string in the text area.** It should be a list of objects, each with an "lo_id" and "level" (e.g., "demonstrated", "developing").
    *   `Next Steps Recommendation`: Text area.
*   **Session Metadata for Teacher Oversight**:
    *   `Conceptual Session Duration (seconds)`: Numerical input.
    *   `Flags for Teacher Review`: Comma-separated text input.
    *   `Session Summary Notes (for teacher)`: Text area.

## 5. Output JSON Format

The Authoring Tool saves dialogues in the project's standard **enhanced AITA JSON format**. This structure is detailed in `DataStrategy.md`. Key aspects relevant to authoring include:
*   All the global fields and nested objects you edit in the UI.
*   `dialogue_turns` is a list of turn objects.
*   For AITA turns, `pedagogical_notes` is saved as a list of strings.
*   Fields like `metadata.tags`, `pedagogical_intent.keywords`, `safeguard_tags`, and `ontology_concept_tags` are saved as lists of strings.

This output is directly usable for creating datasets for the `fine_tune_aita.py` script, ensuring consistency between authored content and programmatically generated data.

## 6. Tips & Basic Troubleshooting

*   **Save Your Work**: Save your dialogue frequently using the "Save Dialogue as JSON" button, especially for longer or more complex dialogues.
*   **Comma-Separated Tags**: For fields like "Tags," "Keywords," "Safeguard Tags," and "Ontology Concept Tags," ensure multiple entries are separated by commas (e.g., `tag1,another tag,third value`). Leading/trailing spaces around tags are automatically stripped.
*   **Pedagogical Notes (AITA Turns)**: Remember to enter each distinct pedagogical note on a **new line** in the text area.
*   **JSON Fields**: For fields requiring JSON input (like Learning Objectives and Mastery Levels in V1), ensure the JSON is valid. You can use an online JSON validator to check syntax if you encounter issues on load.
*   **Loading Files**: If loading a JSON file fails, check the error message. It might be due to invalid JSON syntax or a structure that doesn't match the expected AITA dialogue format (e.g., missing `dialogue_id` or `dialogue_turns`).
*   **One Dialogue at a Time**: The tool currently works with one dialogue file at a time. After saving, use "Create New Dialogue" or "Load AITA Dialogue JSON" to switch to a different dialogue.
*   **Session State**: Your current work is stored in Streamlit's session state. If you close the browser tab, your unsaved work will be lost unless you have saved it to a file.

This guide should help you effectively use the AITA Dialogue Authoring Tool to create and refine valuable training data.

## Future Enhancements for AITA Reasoner

The AITA Reasoner feature relies on rich pedagogical metadata, specifically the `pedagogical_notes` (List of Strings) and `aita_turn_narrative_rationale` (String) fields associated with each AITA dialogue turn.

Currently, these fields are primarily generated by data processing scripts when creating example dialogues. However, for human authors to effectively create and refine AITA dialogues that leverage the Reasoner capabilities, the AITA Dialogue Authoring Tool (`aita_dialogue_authoring_tool.py`) will require enhancements.

**Planned updates to the Authoring Tool will include:**

*   **UI Fields for Pedagogical Notes**: Authors will be able to add, edit, and manage a list of individual pedagogical notes for each AITA turn. Each note should be atomic and describe a specific strategy or observation.
*   **UI Field for Narrative Rationale**: Authors will be able to write or edit a concise narrative rationale summarizing the AITA's main pedagogical intent for that turn.
*   **Guidance and Examples**: The tool may provide examples or prompts to help authors write effective and consistent notes and rationales.
*   **Validation**: Basic validation might be included to ensure the fields are correctly formatted (e.g., `pedagogical_notes` as a list of strings).

These enhancements will empower authors to directly contribute to the transparency and pedagogical richness of AITA dialogues, making the AITA Reasoner insights more robust and widely available. This guide will be updated with detailed instructions once these features are implemented in the authoring tool.
