# Teacher Dashboard Prototype Guide (`teacher_dashboard_prototype.py`)

## 1. Overview

### Purpose
The `teacher_dashboard_prototype.py` script is a Streamlit web application designed to help teachers, administrators, and developers visualize and review interaction logs generated by AI Tutors (AITAs). It provides a user-friendly interface to explore dialogue sessions and understand the behavior of both students and the AITA, including the performance of content moderation safeguards.

### Data Source
The dashboard primarily uses data from the `xapi_statements.jsonl` file. This file is expected to be generated by an AITA client system (such as the `aita_mcp_client.py` developed in this project), where each line is a JSON object structured like an xAPI statement, detailing a single interaction turn.

## 2. Environment Setup

### Recommended Python Version
*   Python 3.9 or higher is recommended for compatibility with Streamlit and other modern libraries.

### Essential Python Libraries
To run the dashboard, you need to install `streamlit` and `pandas`:
```bash
pip install streamlit pandas
```
*   **`streamlit`**: The core library for creating and running the web application.
*   **`pandas`**: Used for data manipulation, particularly for displaying the session overview table.
*   **`json`**: Used for loading data from the JSON Lines file (this is a standard Python library and does not require separate installation).

## 3. Data Source (`xapi_statements.jsonl`)

### Nature of the File
The `xapi_statements.jsonl` file is a **JSON Lines** file. This means:
*   Each line in the file is a complete, self-contained JSON object.
*   Each JSON object represents an xAPI-like statement that logs a single turn of interaction between a user and an AITA. It includes details such as the user's input, the AITA's response, moderation checks, timestamps, session IDs, and more.

### Placeholder Data
The `teacher_dashboard_prototype.py` script includes internal placeholder data. This data will be used automatically if the `xapi_statements.jsonl` file is not found in the same directory as the script. This feature allows the dashboard to be demonstrated even without an existing log file.

## 4. Running the Dashboard

### Command to Run
To start the Streamlit application, navigate to the directory containing `teacher_dashboard_prototype.py` in your terminal and run:
```bash
streamlit run teacher_dashboard_prototype.py
```

### Accessing the Dashboard
After running the command, Streamlit will typically:
*   Automatically open the application in your default web browser.
*   Display a local URL in your terminal, usually `http://localhost:8501`. You can copy and paste this URL into your browser if it doesn't open automatically.

## 5. Key Features and Views

The dashboard has two main views, selectable from the sidebar.

### Sidebar Navigation
*   Located on the left side of the application.
*   Contains a dropdown menu labeled "Select a Session (or Overview):".
*   Use this menu to either:
    *   Select **"Overview"** to see a summary of all recent interaction sessions.
    *   Select a specific **Session ID** (listed with student ID and start time) to view the detailed transcript of that session.

### Overview Page
When "Overview" is selected, this page displays:
*   A table summarizing recent interaction sessions.
*   Columns in the table include:
    *   **Session ID**: The unique identifier for the session.
    *   **Student ID**: The identifier for the student involved.
    *   **Start Time (UTC)**: The timestamp of the first recorded interaction in the session.
    *   **Turn Count**: The total number of interaction turns (user + AITA) in the session.
    *   **First User Utterance**: A snippet of the student's first message in the session, providing quick context.

### Session Transcript View
When a specific Session ID is selected from the sidebar, this view displays:
*   The **Session ID** and **Student ID** for the selected session.
*   A chronological transcript of the dialogue between the user (student) and the AITA, rendered using chat message bubbles.
*   Each turn in the transcript includes:
    *   The **speaker** ("User" or "AITA").
    *   The **timestamp** of the interaction.
    *   The **utterance** (the text spoken/typed).

*   **Detailed Turn Information (Expanders):** For AITA turns (and some user turns), additional details are available in collapsible sections called "expanders":
    *   **"Input Moderation Details"**: (Available for user turns where their input was moderated)
        *   Shows the results from the `ModerationService` for the student's input.
        *   Includes `is_safe` (boolean), `flagged_categories` (list of any content categories that exceeded the moderation threshold), `scores` (a dictionary of all categories and their confidence scores from the moderation model), and `model_used`.
    *   **"Output Moderation Details (AITA Raw)"**: (Available for AITA turns)
        *   Shows the results from the `ModerationService` for the AITA's *raw, original* output before any safeguards might have altered it.
        *   Includes `is_safe`, `flagged_categories`, `scores`, and `model_used`.
    *   **"Original LLM Response (before safeguard override)"**:
        *   This section appears *only if* the AITA's raw output was flagged by the `ModerationService` and replaced with a generic safe message.
        *   It displays the original text generated by the SLM, allowing review of potentially problematic content that was caught and overridden. This is useful for understanding the SLM's unfiltered behavior.
    *   **"Full Prompt to LLM (for this AITA turn)"**: (Available for AITA turns)
        *   Displays the complete prompt that was sent to the SLM to generate the AITA's response for that turn.
        *   This is invaluable for understanding the AITA's behavior, debugging issues, and seeing how context (system prompt, conversation history, fetched LMS data) is being used.

## 6. Understanding the Displayed Data

*   **Moderation Details**:
    *   `is_safe`: `true` indicates the text was deemed appropriate by the moderation model based on its configured threshold. `false` indicates potential issues.
    *   `flagged_categories`: If `is_safe` is `false`, this lists the specific content categories (e.g., "toxic", "insult" from `unitary/toxic-bert`) that were flagged.
    *   `scores`: Provides the raw confidence scores from the moderation model for various categories. This allows for a more nuanced understanding than just the binary `is_safe` flag.
*   **Purpose**: This dashboard is a tool for:
    *   **Oversight**: Monitoring student-AITA interactions.
    *   **Understanding**: Gaining insights into how students interact with different AITAs and learning content.
    *   **Improvement**: Identifying areas where the AITA's responses, pedagogical strategies, or the safeguard mechanisms (including content moderation) might need review or refinement.

## 7. Notes & Troubleshooting

*   **Data File Location**: For the dashboard to display actual interaction data, ensure the `xapi_statements.jsonl` file (generated by `aita_mcp_client.py`) is present in the same directory where you run `streamlit run teacher_dashboard_prototype.py`. Otherwise, it will use the internal placeholder data.
*   **Performance with Large Files**: The dashboard is currently a prototype. For very large `xapi_statements.jsonl` files, the initial loading and processing time might increase as it currently processes the entire file in memory.
*   **Streamlit Issues**: If you encounter issues running the application (e.g., "streamlit: command not found"), ensure Streamlit is installed correctly in your Python environment and that its installation directory is in your system's PATH.
*   **Moderation Model Download**: The first time `aita_mcp_client.py` runs (or if its cache is cleared), the `ModerationService` will download the `unitary/toxic-bert` model. This requires an internet connection. If this fails, the client logs an error and uses a dummy moderation service; the dashboard will still run but moderation details will reflect the dummy service.

This guide should help you get started with using the AITA Teacher Dashboard.
